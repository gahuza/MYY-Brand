{"version":3,"file":"auth.js","names":["jwt","User","auth","req","res","next","token","headers","authorization","startsWith","split","status","json","message","decode","verify","process","env","TOKEN_SECRET","verifyUser","findById","id","user","error","userRole","roles","console","log","includes","role"],"sources":["../../../src/middleware/auth.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport User from '../Models/userModel.js';\r\n\r\nexport const auth = async (req, res, next) => {\r\n  let token;\r\n  try {\r\n    if (\r\n      req.headers.authorization &&\r\n      req.headers.authorization.startsWith('Bearer')\r\n    ) {\r\n      token = req.headers.authorization.split(' ')[1];\r\n    }\r\n\r\n    if (!token) {\r\n      return res.status(401).json({\r\n        status: 'fail',\r\n        message: 'Unauthorized',\r\n      });\r\n    }\r\n\r\n    const decode = jwt.verify(token, process.env.TOKEN_SECRET);\r\n\r\n    const verifyUser = await User.findById(decode.id);\r\n    if (!verifyUser) {\r\n      return res.status(400).json({\r\n        status: 'fail',\r\n        message: 'The user belong to this token those no longer exist',\r\n      });\r\n    }\r\n    req.user = verifyUser;\r\n  } catch (error) {\r\n    return res.status(400).json({\r\n      status: 'fail',\r\n      message: 'Invalid token',\r\n    });\r\n  }\r\n\r\n  next();\r\n};\r\n\r\nexport const userRole = (...roles) => {\r\n  return (req, res, next) => {\r\n    console.log(req.user);\r\n    if (!roles.includes(req.user.role)) {\r\n      return res.status(403).json({\r\n        status: 'fail',\r\n        message: 'Your are not allowed to perform this action',\r\n      });\r\n    }\r\n    next();\r\n  };\r\n};\r\n\r\n"],"mappings":"AAAA,OAAOA,GAAG,MAAM,cAAc;AAC9B,OAAOC,IAAI,MAAM,wBAAwB;AAEzC,OAAO,MAAMC,IAAI,GAAG,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAC5C,IAAIC,KAAK;EACT,IAAI;IACF,IACEH,GAAG,CAACI,OAAO,CAACC,aAAa,IACzBL,GAAG,CAACI,OAAO,CAACC,aAAa,CAACC,UAAU,CAAC,QAAQ,CAAC,EAC9C;MACAH,KAAK,GAAGH,GAAG,CAACI,OAAO,CAACC,aAAa,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACjD;IAEA,IAAI,CAACJ,KAAK,EAAE;MACV,OAAOF,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BD,MAAM,EAAE,MAAM;QACdE,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IAEA,MAAMC,MAAM,GAAGd,GAAG,CAACe,MAAM,CAACT,KAAK,EAAEU,OAAO,CAACC,GAAG,CAACC,YAAY,CAAC;IAE1D,MAAMC,UAAU,GAAG,MAAMlB,IAAI,CAACmB,QAAQ,CAACN,MAAM,CAACO,EAAE,CAAC;IACjD,IAAI,CAACF,UAAU,EAAE;MACf,OAAOf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BD,MAAM,EAAE,MAAM;QACdE,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IACAV,GAAG,CAACmB,IAAI,GAAGH,UAAU;EACvB,CAAC,CAAC,OAAOI,KAAK,EAAE;IACd,OAAOnB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BD,MAAM,EAAE,MAAM;MACdE,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;EAEAR,IAAI,EAAE;AACR,CAAC;AAED,OAAO,MAAMmB,QAAQ,GAAG,CAAC,GAAGC,KAAK,KAAK;EACpC,OAAO,CAACtB,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;IACzBqB,OAAO,CAACC,GAAG,CAACxB,GAAG,CAACmB,IAAI,CAAC;IACrB,IAAI,CAACG,KAAK,CAACG,QAAQ,CAACzB,GAAG,CAACmB,IAAI,CAACO,IAAI,CAAC,EAAE;MAClC,OAAOzB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BD,MAAM,EAAE,MAAM;QACdE,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IACAR,IAAI,EAAE;EACR,CAAC;AACH,CAAC"}