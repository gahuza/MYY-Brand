{"version":3,"file":"blog.controller.js","names":["Blog","commentSchema","cloudinary","dotenv","config","v2","cloud_name","api_key","api_secret","createBlog","req","res","console","log","body","image","uploader","upload","file","path","blog","title","secure_url","save","then","result","json","status","send","ok","catch","error","err","getAllBlogs","blogs","find","number","length","message","getBlogById","findById","_id","params","id","deleteBlog","deleteOne","updateSingleBlog","findOne","folder","public_id","url","success","data","addComment","comments","comment","user","getAllComments","populate","model","select","like","statusCode","alreadyLiked","likes","toString","filter","push","blogId","likesCounting"],"sources":["../../../src/controllers/blog.controller.js"],"sourcesContent":["import Blog from \"../models/Blogs.model.js\";\r\nimport  { commentSchema } from \"../models/commentmod.js\";\r\n// import blogImage from \"../helpers/imageUpload.js\";\r\n\r\n\r\nimport cloudinary  from 'cloudinary';\r\nimport   dotenv  from \"dotenv\"\r\n\r\ndotenv.config()\r\n// import uploader from '../config/cloudinary';\r\ncloudinary.v2;\r\n\r\ncloudinary.config({\r\n        cloud_name:\"dtxq2qcox\",\r\n        api_key: \"172566471358293\",\r\n        api_secret: \"qF01khiT0k3xKyn8ixefLfAlbHE\",\r\n      });\r\n\r\n\r\nexport const createBlog = async function(req, res){\r\n    console.log(\"AASASASASA\", req.body)\r\n    try {\r\n        // if(req.files) {\r\n            \r\n            const image = await cloudinary.uploader.upload(req.file.path);\r\n            // }\r\n               const blog= await new Blog({\r\n                    title:req.body.title,\r\n                    body:req.body.body,\r\n                    image: image.secure_url,\r\n                })\r\n             \r\n            blog.save()\r\n            .then(result=>{\r\n                console.log(result);\r\n                res.json(result)\r\n                res.status(200).send({ok:'add  successfully'});\r\n            })\r\n            .catch(error=>console.log(error))\r\n\r\n    \r\n    }\r\n    catch (err) {\r\n        res.status(500).json(err)\r\n        console.log(err)\r\n    }\r\n\r\n};\r\n// export const getAllBlogs = async(req,res) =>{\r\n//     const blogs = await Blog.find();\r\n//     res.send(blogs);\r\n//   }\r\n\r\n\r\n  export const getAllBlogs = async (req, res) => {\r\n    try {\r\n    const blogs = await Blog.find();\r\n    return res.status(200).json({\r\n    status: \"success\",\r\n    number: blogs.length,\r\n    blogs,\r\n    });\r\n    } catch (error) {\r\n    return res.status(404).json({\r\n    status: \"failed\",\r\n    error: error.message,\r\n    });\r\n    }\r\n    };\r\n\r\n\r\n  // export const getBlogById = async(req,res) =>{\r\n  //   const blogs = await Blog.findById({_id: req.params.id});\r\n  //   res.send(blogs);\r\n  // }\r\n\r\n\r\n  export const getBlogById = async (req, res) => {\r\n    try {\r\n    const blogs = await Blog.findById({_id: req.params.id});\r\n    return res.status(200).json({\r\n    status: \"success\",\r\n    number: blogs.length,\r\n    blogs,\r\n    });\r\n    } catch (error) {\r\n    return res.status(404).json({\r\n    status: \"failed\",\r\n    error: error.message,\r\n    });\r\n    }\r\n    };\r\n\r\n\r\n\r\n  export const deleteBlog = async (req, res) => {\r\n    try {\r\n     await Blog.deleteOne({ _id: req.params.id });\r\n      res.status(207).send({ok:'delete success'});\r\n    } catch {\r\n      res.status(406);\r\n      res.send({ error: \"blog doesn't exist!\" });\r\n    }\r\n  }\r\n\r\n  export const updateSingleBlog = async (req, res) => {\r\n    try {\r\n      const blog = await Blog.findOne({ _id: req.params.id });\r\n  \r\n      if (req.body.title) {\r\n        blog.title = req.body.title;\r\n      }\r\n      if (req.body.body) {\r\n        blog.body = req.body.body;\r\n      }\r\n      if (req.file) {\r\n        blog.image = req.file.path;\r\n        const result = await cloudinary.uploader.upload(req.file.path, {\r\n          folder: 'portfolio/blogImages',\r\n          public_id: `${blog.title}_image`,\r\n        });\r\n        blog.image = result.url;\r\n      }\r\n      await blog.save();\r\n      res.status(300).json({\r\n        status: 300,\r\n        success: true,\r\n        message: 'Blog updated',\r\n        data: blog,\r\n      });\r\n    } catch (err) {\r\n      res\r\n        .status(400)\r\n        .json({ status: 400, success: false, message: \"Blog doesn't exist\" });\r\n    }\r\n  };\r\n\r\n\r\n  export const addComment = async (req, res) => {\r\n    try {\r\n      const blog = await Blog.findOne({ _id: req.params.id });\r\n      if (!blog) {\r\n        res\r\n          .status(404)\r\n          .json({ status: 404, success: false, message: \"Blog doesn't exist\" });\r\n        return;\r\n      } else {\r\n        blog.comments = [\r\n          ...blog.comments,\r\n          { comment: req.body.comment, user: req.user, blog: blog },\r\n        ];\r\n        blog.save();\r\n        res.status(201).json({\r\n          success: true,\r\n          message: `Comment added`,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: `Server Error: Error when adding comment ${error.message}`,\r\n      });\r\n      console.log(`Error while adding comment ${error.message}`);\r\n    }\r\n  };\r\n  export const getAllComments = async (req, res) => {\r\n    try {\r\n      const blog = await Blog\r\n        .findOne({ _id: req.params.id })\r\n        .populate({\r\n          path: 'comments.user',\r\n          model: 'User',\r\n          select: 'username',\r\n        })\r\n        .populate({ path: 'comments.blog', model: 'Blog', select: 'title' });\r\n      if (!blog) {\r\n        res.status(404).json({ error: \"Blog doesn't exist\" });\r\n        return;\r\n      }\r\n  \r\n      res.send(blog.comments);\r\n    } catch {\r\n      res.status(500).json({ error: 'Internal server error' });\r\n    }\r\n  };\r\n\r\n  export const like = async (req, res) => {\r\n    try {\r\n      const blog = await Blog.findById(req.params.id);\r\n      if (!blog) {\r\n        return res.status(404).send({\r\n          statusCode: 404,\r\n          success: false,\r\n          data: { message: 'Blog not found!' },\r\n        });\r\n      }\r\n      //check if the blog is already liked\r\n      const alreadyLiked = blog.likes.find(\r\n        (like) => like.user.toString() === req.user._id.toString(),\r\n      );\r\n      //unlike the blog\r\n      if (alreadyLiked) {\r\n        blog.likes = blog.likes.filter(\r\n          (like) => like.user.toString() !== req.user._id.toString(),\r\n        );\r\n      } else {\r\n        blog.likes.push({\r\n          user: req.user._id,\r\n          blog: req.params.blogId,\r\n        });\r\n      }\r\n      await blog.save();\r\n      res.status(201).json({\r\n        statusCode: 201,\r\n        success: true,\r\n        data: [{ message: 'Done', body: blog }],\r\n      });\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: `Server Error: Error when liking or disliking ${error.message}`,\r\n      });\r\n    }\r\n  };\r\n export const likesCounting = async (req, res) => {\r\n    try {\r\n      const blog = await Blog.findOne({ _id: req.params.id });\r\n      if (!blog) {\r\n        res\r\n          .status(404)\r\n          .json({ status: 404, success: false, message: \"Blog doesn't exist\" });\r\n      } else {\r\n        res.status(200).json({\r\n          status: 200,\r\n          success: true,\r\n          message: `Number of likes: ${blog.likes.length}`,\r\n        });\r\n      }\r\n    } catch (error) {\r\n      res.status(500).json({\r\n        success: false,\r\n        message: `Server Error: Error when fetching likes ${error.message}`,\r\n      });\r\n    }\r\n  };\r\n  "],"mappings":"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"}